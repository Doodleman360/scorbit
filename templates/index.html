<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <title>High Scores</title>
</head>
<body class="">
<div id="main">
</div>
</body>
<script>
    const socket = new WebSocket('ws://' + location.host + '/sock');
    timeoutID = undefined;

    socket.addEventListener('message', ev => {
        const msg = JSON.parse(ev.data);
        console.log("Received message");
        const body = document.getElementById('main');
        cancel_timeout();
        start_timeout(msg.updateFrequency);
        body.innerHTML = msg.html;
    });

    socket.addEventListener('close', (event) => {
        console.log('Socket closed');
        location.reload();
    });

    socket.addEventListener('error', (event) => {
        console.log('Socket error');
        location.reload();
    });

    start_timeout = (time) => {
        this.timeoutID = setTimeout(() => {
            console.log('Socket timeout');
            socket.close();
        }, time*1000+10000);
    }

    cancel_timeout = () => {
        clearTimeout(this.timeoutID);
    }
</script>
</html>
